<!doctype html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Profiles | Young Tech Architect</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="wrap topbar__inner">
      <a class="brand" href="./index.html">
        <span class="brand__mark" aria-hidden="true"></span>
        <span class="brand__text">
          <span class="brand__title">Young Tech Architect</span>
          <span class="brand__subtitle">Profiles</span>
        </span>
      </a>

      <nav class="navRow" aria-label="Primary">
        <a class="nav__link" href="./index.html">Home</a>
        <a class="nav__link is-active" href="./profiles.html">Profiles</a>
        <a class="nav__link" href="./month1.html">Month 1</a>
        <a class="nav__link" href="./month2.html">Month 2</a>
        <a class="nav__link" href="./month3.html">Month 3</a>
        <a class="nav__link" href="./certificates.html">Certificates</a>
        <a class="nav__link" href="./print.html">Print</a>
        <a class="nav__link" href="./dashboard.html">Parent Dashboard</a>
      </nav>

      <div class="topbar__actions">
        <button class="menuBtn" type="button" data-yt="navbtn" aria-expanded="false" aria-label="Open menu">â˜°</button>
        <button class="btn btn--soft" id="kidModeToggle" type="button" aria-pressed="false">Kid Mode: Off</button>
      </div>
    </div>
  </header>

  <div class="backdrop" data-yt="backdrop"></div>
  <aside class="drawer" data-yt="drawer" aria-label="Mobile menu">
    <div class="drawerHeader">
      <div class="drawerTitle">Menu</div>
      <button class="menuBtn" type="button" data-yt="navbtn" aria-expanded="true" aria-label="Close menu">âœ•</button>
    </div>
    <div class="drawerLinks">
      <a href="./index.html">Home</a>
      <a href="./profiles.html">Profiles</a>
      <a href="./month1.html">Month 1</a>
      <a href="./month2.html">Month 2</a>
      <a href="./month3.html">Month 3</a>
      <a href="./certificates.html">Certificates</a>
      <a href="./print.html">Print</a>
      <a href="./dashboard.html">Parent Dashboard</a>
    </div>
  </aside>

  <main class="wrap stack">
    <section class="card stack">
      <h1 class="h1">Child Profiles (Year 3â€“6)</h1>
      <p class="muted">
        Create one profile per child. The plan automatically adjusts to the year group:
        <strong>Year 3â€“4</strong> = Foundation â€¢ <strong>Year 5â€“6</strong> = Builder.
      </p>

      <div class="grid2">
        <div class="card card--soft stack">
          <h2 class="h2">Create a new profile</h2>

          <label class="small muted" for="childName">Child name</label>
          <input id="childName" class="input" placeholder="e.g., Alex" />

          <label class="small muted" for="yearGroup">Year group</label>
          <select id="yearGroup" class="input">
            <option value="3">Year 3</option>
            <option value="4">Year 4</option>
            <option value="5" selected>Year 5</option>
            <option value="6">Year 6</option>
          </select>

          <label class="small muted" for="startDate">Start date (pick a Monday if you can)</label>
          <input id="startDate" class="input" type="date" />

          <div class="ctaRow">
            <button class="btn btn--primary" id="createProfileBtn" type="button">Create profile</button>
            <button class="btn btn--soft" id="setNextMonBtn" type="button">Set start to next Monday</button>
          </div>

          <div class="quote small">
            Start date makes week ranges & streaks work nicely (Monâ€“Sat). If you skip it, the plan still works.
          </div>
        </div>

        <div class="card card--soft stack">
          <h2 class="h2">Active profile</h2>
          <div class="pillrow">
            <span class="pill pill--static"><span class="pill__k">Name</span><span class="pill__v" id="activeName">â€”</span></span>
            <span class="pill pill--static"><span class="pill__k">Year</span><span class="pill__v" id="activeYear">â€”</span></span>
            <span class="pill pill--static"><span class="pill__k">Track</span><span class="pill__v" id="activeTrack">â€”</span></span>
            <span class="pill pill--static"><span class="pill__k">Start</span><span class="pill__v" id="activeDate">â€”</span></span>
          </div>
          <div class="ctaRow">
            <a class="btn" href="./month1.html">Go to Month 1</a>
            <a class="btn" href="./certificates.html">Certificates</a>
            <a class="btn" href="./dashboard.html">Dashboard</a>
          </div>
        </div>
      </div>
    </section>

    <section class="card stack">
      <h2 class="h2">All profiles</h2>
      <div id="profilesList" class="monthRows"></div>
    </section>
  </main>

  <footer class="footer wrap">
    <span class="muted small">All data stays on this device (local storage).</span>
  </footer>

  <script src="./app.js"></script>
  <script>
    YTA.init();
    YTA.initKidModeUI();

    const childName = document.getElementById("childName");
    const yearGroup = document.getElementById("yearGroup");
    const startDate = document.getElementById("startDate");
    const createBtn = document.getElementById("createProfileBtn");
    const profilesList = document.getElementById("profilesList");

    function render(){
      const active = YTA.getActiveProfile();
      const curriculum = YTA.getActiveCurriculum();

      document.getElementById("activeName").textContent = active ? active.name : "No profile";
      document.getElementById("activeYear").textContent = active?.yearGroup ?? "â€”";
      document.getElementById("activeTrack").textContent = curriculum?.name ?? "â€”";
      document.getElementById("activeDate").textContent = active?.startDate ? YTA.fmtDate(active.startDate) : "Not set";

      const profiles = YTA.getProfiles();
      profilesList.innerHTML = profiles.map(p => {
        const isActive = active && active.id === p.id;
        const prog = YTA.computeOverallProgress(p.id);
        const streak = YTA.computeStreak(p.id);
        const trackLabel = (p.track === "foundation") ? "Foundation" : "Builder";

        return `
          <div class="row">
            <div>
              <div class="row__title">${p.name} ${isActive ? "â€¢ âœ… Active" : ""}</div>
              <div class="row__meta">
                Year ${p.yearGroup} â€¢ ${trackLabel} â€¢ Start: ${p.startDate ? YTA.fmtDate(p.startDate) : "Not set"}
                â€¢ Progress: ${prog.completeDays}/${prog.totalDays} â€¢ Streak: ${streak}ðŸ”¥
              </div>
            </div>
            <div class="ctaRow">
              <button class="btn btn--soft" data-act="set" data-id="${p.id}">Set Active</button>
              <button class="btn" data-act="edit" data-id="${p.id}">Edit</button>
              <button class="btn btn--danger" data-act="delete" data-id="${p.id}">Delete</button>
            </div>
          </div>
        `;
      }).join("");

      profilesList.querySelectorAll("button[data-act]").forEach(btn => {
        btn.addEventListener("click", () => {
          const act = btn.getAttribute("data-act");
          const id = btn.getAttribute("data-id");

          if(act === "set"){
            YTA.setActiveProfile(id);
            render();
            return;
          }
          if(act === "delete"){
            YTA.deleteProfile(id);
            render();
            return;
          }
          if(act === "edit"){
            const p = YTA.getProfileById(id);
            if(!p) return;

            const newName = prompt("Child name:", p.name) ?? p.name;
            const newYear = prompt("Year group (3,4,5,6):", String(p.yearGroup)) ?? String(p.yearGroup);
            const newStart = prompt("Start date (YYYY-MM-DD) or blank:", p.startDate || "") ?? (p.startDate || "");

            const yg = [3,4,5,6].includes(Number(newYear)) ? Number(newYear) : p.yearGroup;

            YTA.updateProfile(id, { name: newName.trim(), yearGroup: yg, startDate: (newStart || "").trim() });
            render();
          }
        });
      });
    }

    createBtn.addEventListener("click", () => {
      const name = (childName.value || "").trim();
      if(!name){
        alert("Please enter a child name.");
        return;
      }
      YTA.createProfile({
        name,
        yearGroup: yearGroup.value,
        startDate: (startDate.value || "").trim()
      });
      childName.value = "";
      startDate.value = "";
      render();
    });

    document.getElementById("setNextMonBtn").addEventListener("click", () => {
      startDate.value = YTA.nextMondayISO();
    });

    render();
  </script>
</body>
</html>
